<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ReadTogether - Student</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .user-info {
      font-size: 18px;
      color: #1565c0;
    }
    .logout-btn {
      background-color: #f44336;
      padding: 10px 20px;
      font-size: 16px;
    }
    .logout-btn:hover {
      background-color: #d32f2f;
    }
  </style>
</head>
<body>
  <div class="header-bar">
    <div class="header-left">
      <a href="/" style="padding: 0; background: none; text-decoration: none; display: inline-block;">
        <img src="/static/WordyBirdyLogo.png" alt="WordyBirdy Logo" style="width: 60px; height: auto;">
      </a>
      <div>
        <h1 style="margin: 0;">Student Dashboard</h1>
        <p class="user-info" id="welcomeMessage">Loading...</p>
      </div>
    </div>
    <button class="logout-btn" onclick="handleLogout()">Logout</button>
  </div>
  
  <h2>Your Assignments</h2>
  <div id="assignmentsList">
    <p>Loading assignments...</p>
  </div>
  
  <script>
    // Load user info
    async function loadUserInfo() {
      try {
        const response = await fetch('/api/current-user');
        if (response.ok) {
          const user = await response.json();
          document.getElementById('welcomeMessage').textContent = `Welcome, ${user.full_name}!`;
        } else {
          window.location.href = '/';
        }
      } catch (err) {
        console.error('Error loading user info:', err);
        window.location.href = '/';
      }
    }
    
    // Handle logout
    async function handleLogout() {
      try {
        await fetch('/api/logout', { method: 'POST' });
        window.location.href = '/';
      } catch (err) {
        console.error('Error logging out:', err);
        window.location.href = '/';
      }
    }
    
    async function loadAssignments() {
      try {
        const response = await fetch('/api/assignments');
        const assignments = await response.json();
        
        const listDiv = document.getElementById('assignmentsList');
        
        if (assignments.length === 0) {
          listDiv.innerHTML = '<p>No assignments available yet.</p>';
          return;
        }
        
        listDiv.innerHTML = '<ul>' + 
          assignments.map(assignment => 
            `<li>
              <strong>${assignment.title}</strong> (Grade ${assignment.grade_level})
              <button onclick="openAssignment(${assignment.id})">Start Assignment</button>
            </li>`
          ).join('') + 
        '</ul>';
      } catch (err) {
        document.getElementById('assignmentsList').innerHTML = 
          '<p>Error loading assignments: ' + err.message + '</p>';
      }
    }
    
    function openAssignment(assignmentId) {
      window.location.href = `/assignment?id=${assignmentId}`;
    }
    
    // Initialize
    loadUserInfo();
    loadAssignments();
  </script>
</body>
</html>

